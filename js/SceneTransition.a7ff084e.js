"use strict";(self["webpackChunkcreation_gallery"]=self["webpackChunkcreation_gallery"]||[]).push([[524],{11027:function(t,e,n){n.d(e,{hw:function(){return l},AU:function(){return f.AU},Gc:function(){return f.Gc},_f:function(){return f._f},Ki:function(){return f.Ki},H7:function(){return f.H7},C8:function(){return o},n_:function(){return c},Et:function(){return u},Gv:function(){return i},ZF:function(){return r},Kg:function(){return a},X6:function(){return d},on:function(){return m},cM:function(){return h}});n(53297);function i(t){return"[object Object]"===Object.prototype.toString.call(t)}function r(t){if(i(t)){const e=Object.keys(t);return 0===e.length}return!1}function s(t){return"[object Undefined]"===Object.prototype.toString.call(t)}function o(t){return!s(t)}function a(t){return"string"===typeof t}function u(t){return"number"===typeof t}function c(t){return"object"===typeof HTMLElement?t instanceof HTMLElement:t&&"object"===typeof t&&1===t.nodeType&&"string"===typeof t.nodeName}var f=n(21966);function l(t=1,e=10){return Math.floor(Math.random()*(e-t+1))+t}function h(t,e=!0){if(""===t||0===t||!t)return"0";const n=t+"",i=n.indexOf(".");let r="",s="";-1!==i?(e&&(r=n.substring(i)),s=n.substring(0,i)):s=n;let o=s.split("");if(o.length>=4){const t=[],e=o.reverse();for(let n=0;n<e.length;n++)t.push(e[n]),(n+1)%3===0&&t.push(",");o=t.reverse(),o.length&&","===o[0]&&o.shift()}return o.join("")+(e?r:"")}function d(t,e=2){try{const n=parseFloat(t);return n.toFixed(e)}catch(n){return"0"}}function m(t,e,n){t&&e&&n&&t.addEventListener(e,n,!1)}},99321:function(t,e,n){n.r(e),n.d(e,{default:function(){return g}});var i=n(58258),r=(n(53297),n(11027)),s=n(75030),o=n(68625);let a,u,c;class f{constructor(t){const e=document.getElementById("webgl-output"),{color:n}=t;this.scene=(0,r.H7)(),this.scene.background=new s.Q1f(0);const i={minFilter:s.k6q,magFilter:s.k6q,stencilBuffer:!1};this.fbo=new s.nWS(e.offsetWidth,e.offsetHeight,i),(0,r.AU)(this.scene,10);for(let r=0;r<10;r++){const t=new s.eaF(new s.Gu$(1,20),new s.V9B({color:n}));t.position.set(10*Math.random(),10*Math.random(),10*Math.random()),this.scene.add(t)}}render(t=0,e=!1){e?(a.setRenderTarget(this.fbo),a.clear(),a.render(this.scene,u)):(a.setRenderTarget(null),a.render(this.scene,u)),c.update()}}function l(t,e,n){const i=document.getElementById("webgl-output");this.scene=new s.Z58,this.scene.background=new s.Q1f(0),this.camera=new s.qUd(i.offsetWidth/-2,i.offsetWidth/2,i.offsetHeight/2,i.offsetHeight/-2,-10,10),this.material=new s.BKk({uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:0},threshold:{value:.1},useTexture:{value:!0},tMixTexture:{value:n.texture}},vertexShader:"\n    varying vec2 vUv;\n\t\t\tvoid main() {\n\t\t\t\tvUv = vec2( uv.x, uv.y );\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t}\n    ",fragmentShader:"\n      uniform float mixRatio;\n\t\t\tuniform sampler2D tDiffuse1;\n\t\t\tuniform sampler2D tDiffuse2;\n\t\t\tuniform sampler2D tMixTexture;\n\t\t\tuniform bool useTexture;\n\t\t\tuniform float threshold;\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main() {\n\t\t\t\tvec4 texel1 = texture2D( tDiffuse1, vUv );\n\t\t\t\tvec4 texel2 = texture2D( tDiffuse2, vUv );\n\t\t\t\tif (useTexture==true) {\n\t\t\t\t\tvec4 transitionTexel = texture2D( tMixTexture, vUv );\n\t\t\t\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\t\t\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\t\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t\t\t\t} else {\n\t\t\t\t\tgl_FragColor = mix( texel2, texel1, mixRatio );\n\t\t\t\t}\n\t\t\t}\n    "});const r=new s.bdM(i.offsetWidth,i.offsetHeight);this.quad=new s.eaF(r,this.material),this.scene.add(this.quad),this.update=(t,e,i=!1)=>{this.scene1=t,this.scene2=e,this.material.uniforms.tDiffuse1.value=this.scene2.fbo.texture,this.material.uniforms.tDiffuse2.value=this.scene1.fbo.texture,this.material.uniforms.threshold.value=.1,this.material.uniforms.mixRatio.value=0,this.material.uniforms.tMixTexture.value=n.texture,this.material.uniforms.useTexture.value=n.useTexture,n.animate=i,n.transition=0},this.render=()=>{0===n.transition?this.scene1.render():n.transition>=1?(this.scene2.render(),n.animate=!1):(this.scene1.render(0,!0),this.scene2.render(0,!0),a.setRenderTarget(null),a.clear(),a.render(this.scene,this.camera)),n.animate&&n.transition<=1&&(n.transition=n.transition+n.transitionSpeed,this.material.uniforms.mixRatio.value=n.transition)},this.update(t,e,!1)}class h{constructor(){a=(0,r.Ki)({physicallyCorrectLights:!1}),u=(0,r.Gc)(new s.Pq0(20,30,10),55,1,2e4),c=new o.N(u,a.domElement),c.minDistance=5,c.maxDistance=20,c.enablePan=!1,c.enableDamping=!0,c.dampingFactor=.05;const t=new f({color:16711680}),e=new f({color:16776960}),n=new f({color:65280}),i=new f({color:255}),h=[],d=new s.Tap;for(let r=0;r<6;r++)h.push(d.load(`/images/textures/transition/transition${r+1}.png`));this.transitionParams={useTexture:!0,transition:0,transitionSpeed:.05,texture:h[0],animate:!1},this.transition=new l(t,e,this.transitionParams),this.gui=(0,r._f)();let m=0;const x={next:()=>{this.transitionParams.texture=h[parseInt(6*Math.random())],0===m?this.transition.update(t,e,!0):1===m?this.transition.update(e,n,!0):2===m?this.transition.update(n,i,!0):3===m&&(this.transition.update(i,t,!0),m=-1),m++}};this.gui.add(x,"next").name("下一个场景"),this.gui.add(this.transitionParams,"transitionSpeed",0,1).step(.01).name("过渡速度"),this.gui.add(this.transitionParams,"useTexture").name("使用图案"),this.render()}render(){this.transition.render(),requestAnimationFrame(this.render.bind(this))}beforeDestroy(){this.gui.destroy(),window.removeEventListener("resize",this._resizeFn)}}const d={id:"webgl-output",class:"webgl-output"},m={name:"SceneTransition"};var x=Object.assign(m,{setup(t){let e;return(0,i.sV)((()=>{e=new h})),(0,i.xo)((()=>{e&&e.beforeDestroy()})),(t,e)=>((0,i.uX)(),(0,i.CE)("div",d))}});const v=x;var g=v}}]);