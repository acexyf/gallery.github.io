"use strict";(self["webpackChunkcreation_gallery"]=self["webpackChunkcreation_gallery"]||[]).push([[524],{11027:function(t,e,n){n.d(e,{hw:function(){return c},AU:function(){return u.AU},Gc:function(){return u.Gc},_f:function(){return u._f},Ki:function(){return u.Ki},H7:function(){return u.H7},n_:function(){return a},Et:function(){return o},Gv:function(){return i},ZF:function(){return r},Kg:function(){return s},X6:function(){return f},cM:function(){return l}});n(53297);function i(t){return"[object Object]"===Object.prototype.toString.call(t)}function r(t){if(i(t)){const e=Object.keys(t);return 0===e.length}return!1}function s(t){return"string"===typeof t}function o(t){return"number"===typeof t}function a(t){return"object"===typeof HTMLElement?t instanceof HTMLElement:t&&"object"===typeof t&&1===t.nodeType&&"string"===typeof t.nodeName}var u=n(21966);function c(t=1,e=10){return Math.floor(Math.random()*(e-t+1))+t}function l(t,e=!0){if(""===t||0===t||!t)return"0";const n=t+"",i=n.indexOf(".");let r="",s="";-1!==i?(e&&(r=n.substring(i)),s=n.substring(0,i)):s=n;let o=s.split("");if(o.length>=4){const t=[],e=o.reverse();for(let n=0;n<e.length;n++)t.push(e[n]),(n+1)%3===0&&t.push(",");o=t.reverse(),o.length&&","===o[0]&&o.shift()}return o.join("")+(e?r:"")}function f(t,e=2){try{const n=parseFloat(t);return n.toFixed(e)}catch(n){return"0"}}},99321:function(t,e,n){n.r(e),n.d(e,{default:function(){return x}});var i=n(58258),r=(n(53297),n(11027)),s=n(75030),o=n(68625);let a;class u{constructor(t){const e=document.getElementById("webgl-output"),{color:n}=t;this.scene=(0,r.H7)(),this.scene.background=new s.Q1f(0),this.camera=(0,r.Gc)(new s.Pq0(20,30,10),55,1,2e4),this.controls=new o.N(this.camera,a.domElement),this.controls.minDistance=5,this.controls.maxDistance=20,this.controls.enablePan=!1,this.controls.enableDamping=!0,this.controls.dampingFactor=.05;const i={minFilter:s.k6q,magFilter:s.k6q,stencilBuffer:!1};this.fbo=new s.nWS(e.offsetWidth,e.offsetHeight,i),(0,r.AU)(this.scene,10);for(let r=0;r<10;r++){const t=new s.eaF(new s.Gu$(1,20),new s.V9B({color:n}));t.position.set(10*Math.random(),10*Math.random(),10*Math.random()),this.scene.add(t)}}render(t=0,e=!1){e?(a.setRenderTarget(this.fbo),a.clear(),a.render(this.scene,this.camera)):(a.setRenderTarget(null),a.render(this.scene,this.camera)),this.controls.update()}}function c(t,e,n){const i=document.getElementById("webgl-output");this.scene=new s.Z58,this.scene.background=new s.Q1f(0),this.camera=new s.qUd(i.offsetWidth/-2,i.offsetWidth/2,i.offsetHeight/2,i.offsetHeight/-2,-10,10),this.material=new s.BKk({uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:0},threshold:{value:.1},useTexture:{value:!0},tMixTexture:{value:n.texture}},vertexShader:"\n    varying vec2 vUv;\n\t\t\tvoid main() {\n\t\t\t\tvUv = vec2( uv.x, uv.y );\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t}\n    ",fragmentShader:"\n      uniform float mixRatio;\n\t\t\tuniform sampler2D tDiffuse1;\n\t\t\tuniform sampler2D tDiffuse2;\n\t\t\tuniform sampler2D tMixTexture;\n\t\t\tuniform bool useTexture;\n\t\t\tuniform float threshold;\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main() {\n\t\t\t\tvec4 texel1 = texture2D( tDiffuse1, vUv );\n\t\t\t\tvec4 texel2 = texture2D( tDiffuse2, vUv );\n\t\t\t\tif (useTexture==true) {\n\t\t\t\t\tvec4 transitionTexel = texture2D( tMixTexture, vUv );\n\t\t\t\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\t\t\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\t\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t\t\t\t} else {\n\t\t\t\t\tgl_FragColor = mix( texel2, texel1, mixRatio );\n\t\t\t\t}\n\t\t\t}\n    "});const r=new s.bdM(i.offsetWidth,i.offsetHeight);this.quad=new s.eaF(r,this.material),this.scene.add(this.quad),this.update=(t,e,i=!1)=>{this.scene1=t,this.scene2=e,this.material.uniforms.tDiffuse1.value=this.scene2.fbo.texture,this.material.uniforms.tDiffuse2.value=this.scene1.fbo.texture,this.material.uniforms.threshold.value=.1,this.material.uniforms.mixRatio.value=0,this.material.uniforms.tMixTexture.value=n.texture,this.material.uniforms.useTexture.value=n.useTexture,n.animate=i,n.transition=0},this.render=()=>{0===n.transition?this.scene1.render():n.transition>=1?(this.scene2.render(),n.animate=!1):(this.scene1.render(0,!0),this.scene2.render(0,!0),a.setRenderTarget(null),a.clear(),a.render(this.scene,this.camera)),console.log(n.transition,n.animate),n.animate&&n.transition<=1&&(n.transition=n.transition+n.transitionSpeed,this.material.uniforms.mixRatio.value=n.transition)},this.update(t,e,!1)}class l{constructor(){this.renderer=(0,r.Ki)({physicallyCorrectLights:!1}),a=this.renderer;const t=new u({color:16711680}),e=new u({color:16776960}),n=new u({color:65280}),i=new u({color:255}),o=[],l=new s.Tap;for(let r=0;r<6;r++)o.push(l.load(`/images/textures/transition/transition${r+1}.png`));this.transitionParams={useTexture:!0,transition:0,transitionSpeed:.05,texture:o[0],animate:!1},this.transition=new c(t,e,this.transitionParams);const f=(0,r._f)();let h=0;const m={next:()=>{this.transitionParams.texture=o[parseInt(6*Math.random())],this.transitionParams.useTexture=!0,0===h?this.transition.update(t,e,!0):1===h?this.transition.update(e,n,!0):2===h?this.transition.update(n,i,!0):3===h&&(this.transition.update(i,t,!0),h=-1),h++}};f.add(m,"next").name("下一个场景"),this.render()}render(){this.transition.render(),requestAnimationFrame(this.render.bind(this))}}const f={id:"webgl-output",class:"webgl-output"},h={name:"SceneTransition"};var m=Object.assign(h,{setup(t){return(0,i.sV)((()=>{new l})),(t,e)=>((0,i.uX)(),(0,i.CE)("div",f))}});const d=m;var x=d}}]);