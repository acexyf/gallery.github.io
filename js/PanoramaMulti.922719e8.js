"use strict";(self["webpackChunkcreation_gallery"]=self["webpackChunkcreation_gallery"]||[]).push([[137],{30858:function(e,t,n){n.r(t),n.d(t,{default:function(){return K}});n(53297);var i=n(58258),s=n(47199),a=n(17562);const r={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},o=(0,i.Lk)("path",{d:"M4 13h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zm0 8h6c.55 0 1-.45 1-1v-4c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v4c0 .55.45 1 1 1zm10 0h6c.55 0 1-.45 1-1v-8c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1v8c0 .55.45 1 1 1zM13 4v4c0 .55.45 1 1 1h6c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1h-6c-.55 0-1 .45-1 1z",fill:"currentColor"},null,-1),u=[o];var l=(0,i.pM)({name:"DashboardRound",render:function(e,t){return(0,i.uX)(),(0,i.CE)("svg",r,u)}}),c=n(64634),m=n(75030),h=n(68309),d=n(68625);let v,f,g,p,x,w;class b{constructor(e){const{url:t}=e;this.scene=(0,c.H7)();const n={minFilter:m.k6q,magFilter:m.k6q,stencilBuffer:!1},i=new m.Gu$(500,50,50);i.scale(-1,1,1);const s=new m.V9B({map:(new m.Tap).load(t)}),a=new m.eaF(i,s);this.scene.add(a),this.fbo=new m.nWS(f,g,n)}render(e=0,t=!1){t?(v.setRenderTarget(this.fbo),v.clear(),v.render(this.scene,p)):(v.setRenderTarget(null),v.render(this.scene,p)),x.update()}}function T(e){const t={transition:0,texture:void 0,useTexture:!1,transitionSpeed:.05,animate:!1};this.sceneFrom=e,this.sceneTo=void 0,this.scene=new m.Z58,this.scene.background=new m.Q1f(0),this.camera=new m.qUd(f/-2,f/2,g/2,g/-2,-10,10),this.material=new m.BKk({uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:0},threshold:{value:.1},useTexture:{value:!0},tMixTexture:{value:t.texture}},vertexShader:"\n    varying vec2 vUv;\n\t\t\tvoid main() {\n\t\t\t\tvUv = vec2( uv.x, uv.y );\n\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t}\n    ",fragmentShader:"\n      uniform float mixRatio;\n\t\t\tuniform sampler2D tDiffuse1;\n\t\t\tuniform sampler2D tDiffuse2;\n\t\t\tuniform sampler2D tMixTexture;\n\t\t\tuniform bool useTexture;\n\t\t\tuniform float threshold;\n\t\t\tvarying vec2 vUv;\n\t\t\tvoid main() {\n\t\t\t\tvec4 texel1 = texture2D( tDiffuse1, vUv );\n\t\t\t\tvec4 texel2 = texture2D( tDiffuse2, vUv );\n\t\t\t\tif (useTexture==true) {\n\t\t\t\t\tvec4 transitionTexel = texture2D( tMixTexture, vUv );\n\t\t\t\t\tfloat r = mixRatio * (1.0 + threshold * 2.0) - threshold;\n\t\t\t\t\tfloat mixf=clamp((transitionTexel.r - r)*(1.0/threshold), 0.0, 1.0);\n\t\t\t\t\tgl_FragColor = mix( texel1, texel2, mixf );\n\t\t\t\t} else {\n\t\t\t\t\tgl_FragColor = mix( texel2, texel1, mixRatio );\n\t\t\t\t}\n\t\t\t}\n    "});const n=new m.bdM(f,g);this.quad=new m.eaF(n,this.material),this.scene.add(this.quad),this.update=(e,n)=>{if(t.animate)return!1;const{texture:i,useTexture:s=!1,transitionSpeed:a=.05}=n;return this.sceneTo=e,t.transition=0,t.texture=i,t.transitionSpeed=a,t.useTexture=s,t.animate=!0,this.material.uniforms.tDiffuse1.value=this.sceneTo.fbo.texture,this.material.uniforms.tDiffuse2.value=this.sceneFrom.fbo.texture,this.material.uniforms.threshold.value=.1,this.material.uniforms.mixRatio.value=0,this.material.uniforms.tMixTexture.value=i,this.material.uniforms.useTexture.value=s,!0},this.render=()=>{0===t.transition?(0,c.C8)(this.sceneFrom)&&this.sceneFrom.render():t.transition>=1?((0,c.C8)(this.sceneTo)&&this.sceneTo.render(),t.animate=!1,setTimeout((()=>{this.sceneFrom=this.sceneTo,t.transition=0}),10)):((0,c.C8)(this.sceneFrom)&&this.sceneFrom.render(0,!0),(0,c.C8)(this.sceneTo)&&this.sceneTo.render(0,!0),v.setRenderTarget(null),v.clear(),v.render(this.scene,this.camera)),t.animate&&t.transition<=1&&(t.transition=t.transition+t.transitionSpeed,this.material.uniforms.mixRatio.value=t.transition)}}class C{constructor(){const e=document.getElementById("webgl-output");f=e.offsetWidth,g=e.offsetHeight,v=(0,c.Ki)({physicallyCorrectLights:!1}),p=(0,c.Gc)(new m.Pq0(0,500,2),100,1,2e4),x=new d.N(p,v.domElement),x.minDistance=5,x.maxDistance=20,x.enablePan=!1,x.enableDamping=!0,x.dampingFactor=.05,this.scene1=new b({url:"/images/panorama/simons_town_harbour.jpg"}),this.scene2=new b({url:"/images/panorama/sunset.jpg"}),this.scene3=new b({url:"/images/panorama/kandao3.jpg"}),this.scene4=new b({url:"/images/panorama/veranda.jpg"}),this.scene5=new b({url:"/images/panorama/train.jpg"}),this.textures=[];const t=new m.Tap;for(let n=0;n<6;n++)this.textures.push(t.load(`/images/textures/transition/transition${n+1}.png`));this.transitionParams={useTexture:!1,transition:0,transitionSpeed:.05,texture:this.textures[0],animate:!1},this.transition=new T(this.scene1),w=(0,c._f)(),w.add(this.transitionParams,"transitionSpeed",0,1).step(.01).name("过渡速度"),w.add(this.transitionParams,"useTexture").name("是否使用图案"),setTimeout((()=>{this.animateCamera()}),1500),this._resizeFn=this.resizeFn.bind(this),window.addEventListener("resize",this._resizeFn),this.render()}animateCamera(){new h.Ay.Tween({y:500,fov:100,z:0}).to({y:0,fov:70,z:-200},4e3).onComplete((()=>{console.log("1")})).onUpdate((e=>{p.position.y=e.y,p.updateProjectionMatrix(),p.fov=e.fov,p.lookAt(new m.Pq0(0,0,e.z))})).start()}changeScene(e){let t;0===e?t=this.scene1:1===e?t=this.scene2:2===e?t=this.scene3:3===e?t=this.scene4:4===e&&(t=this.scene5),(0,c.C8)(t)&&(this.transitionParams.texture=this.textures[parseInt(6*Math.random())],this.transition.update(t,this.transitionParams))}resizeFn(){v.setSize(window.innerWidth,window.innerHeight),p.aspect=window.innerWidth/window.innerHeight,p.updateProjectionMatrix()}render(){h.Ay.update(),this.transition.render(),requestAnimationFrame(this.render.bind(this))}beforeDestroy(){w&&w.destroy(),window.removeEventListener("resize",this._resizeFn)}}const F=new Map;let k;function y(e,t){console.log(t.arg,"arg");let n=[];return Array.isArray(t.arg)?n=t.arg:n.push(t.arg),function(i,s){const a=t.instance.popperRef,r=i.target,o=s.target,u=!t||!t.instance,l=!r||!o,c=e.contains(r)||e.contains(o),m=e===r,h=n.length&&n.some((e=>e?.contains(r)))||n.length&&n.includes(o),d=a&&(a.contains(r)||a.contains(o));u||l||c||m||h||d||t.value()}}(0,c.on)(document,"mousedown",(e=>k=e)),(0,c.on)(document,"mouseup",(e=>{for(const{documentHandler:t}of F.values())t(e,k)}));const D={beforeMount(e,t){F.set(e,{documentHandler:y(e,t),bindingFn:t.value})},updated(e,t){F.set(e,{documentHandler:y(e,t),bindingFn:t.value})},unmounted(e){F.delete(e)}};var R=D;const _=e=>((0,i.Qi)("data-v-9f0f55aa"),e=e(),(0,i.jt)(),e),z={class:"relative"},M=_((()=>(0,i.Lk)("div",{id:"webgl-output"},null,-1))),S={class:"flex justify-center items-center"},P=_((()=>(0,i.Lk)("div",null,"选择场景",-1))),j=["onClick"],L=["src"],q={class:"scene-item_desc"},E={name:"PanoramaMulti"};var H=Object.assign(E,{setup(e){const t=(0,a.KR)([{name:"滨海",image:"/images/panorama/thumb/thumb1.png"},{name:"日落",image:"/images/panorama/thumb/thumb2.png"},{name:"巨石",image:"/images/panorama/thumb/thumb3.png"},{name:"走廊",image:"/images/panorama/thumb/thumb4.png"},{name:"火车",image:"/images/panorama/thumb/thumb5.png"}]),n=(0,a.KR)(0),r=(0,a.KR)(!1);let o;const u=()=>{r.value=!r.value},m=()=>{r.value=!1},h=(e,t)=>{t!==n.value&&(n.value=t,(0,c.C8)(o)&&o.changeScene(t))},d=(0,a.KR)([]);return(0,i.sV)((()=>{d.value.push(document.querySelector(".select-scene")),o=new C})),(0,i.xo)((()=>{o&&o.beforeDestroy()})),(e,o)=>{const c=(0,i.g2)("n-icon");return(0,i.uX)(),(0,i.CE)("div",z,[M,(0,i.Lk)("div",{class:(0,s.C4)(["select-scene"]),onClick:u},[(0,i.Lk)("div",S,[(0,i.bF)(c,{size:"30"},{default:(0,i.k6)((()=>[(0,i.bF)((0,a.R1)(l))])),_:1})]),P]),(0,i.bo)(((0,i.uX)(),(0,i.CE)("div",{class:(0,s.C4)(["scene-list_box",r.value?"show":""])},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.value,((e,t)=>((0,i.uX)(),(0,i.CE)("div",{class:(0,s.C4)(["scene-item",(n.value,"")]),key:t,onClick:n=>h(e,t)},[(0,i.Lk)("img",{src:e.image,alt:""},null,8,L),(0,i.Lk)("div",q,(0,s.v_)(e.name),1)],10,j)))),128))],2)),[[(0,a.R1)(R),m,d.value]])])}}}),U=n(20541);const A=(0,U.A)(H,[["__scopeId","data-v-9f0f55aa"]]);var K=A}}]);