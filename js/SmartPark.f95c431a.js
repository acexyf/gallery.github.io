"use strict";(self["webpackChunkcreation_gallery"]=self["webpackChunkcreation_gallery"]||[]).push([[70],{34056:function(e,t,r){r.d(t,{I:function(){return g},X:function(){return S}});var i=r(58258),o=r(47199);const a=e=>((0,i.Qi)("data-v-0b0756b3"),e=e(),(0,i.jt)(),e),n={class:"loading-box"},s=a((()=>(0,i.Lk)("div",{class:"loader"},null,-1))),d={class:"loadertext"},l={name:"LoadingBox"};var h=Object.assign(l,{props:{progress:{type:Number,default:0}},setup(e){return(t,r)=>((0,i.uX)(),(0,i.CE)("div",n,[s,(0,i.Lk)("div",d,(0,o.v_)(e.progress)+"%",1)]))}}),c=r(20541);const u=(0,c.A)(h,[["__scopeId","data-v-0b0756b3"]]);var g=u,f=r(76507);const m=e=>((0,i.Qi)("data-v-9e9dfc54"),e=e(),(0,i.jt)(),e),v={class:"loading-box"},p={key:0},b=m((()=>(0,i.Lk)("div",{class:"flip-loader"},null,-1))),w={class:"txt"},k={key:1},y=(0,i.Fv)('<div class="stretch" data-v-9e9dfc54><div class="rect rect1" data-v-9e9dfc54></div><div class="rect rect2" data-v-9e9dfc54></div><div class="rect rect3" data-v-9e9dfc54></div><div class="rect rect4" data-v-9e9dfc54></div><div class="rect rect5" data-v-9e9dfc54></div></div>',1),L={class:"txt"},x={key:2,class:"loading-text-blur"},C=(0,i.Fv)('<div class="loading-text-words" data-v-9e9dfc54>L</div><div class="loading-text-words" data-v-9e9dfc54>O</div><div class="loading-text-words" data-v-9e9dfc54>A</div><div class="loading-text-words" data-v-9e9dfc54>D</div><div class="loading-text-words" data-v-9e9dfc54>I</div><div class="loading-text-words" data-v-9e9dfc54>N</div><div class="loading-text-words" data-v-9e9dfc54>G</div>',7),T=[C],_={name:"LoadingFixed"};var D=Object.assign(_,{props:{animation:{type:String,default:"Flip"},progress:{type:Number,default:0},color:{type:String,default:"#67cf22"},backgroundColor:{type:String,default:"#f1f1f1"}},setup(e){return(0,f.$9)((t=>({"3491e98c":e.backgroundColor,ba106a4c:e.color}))),(t,r)=>((0,i.uX)(),(0,i.CE)("div",v,["Flip"===e.animation?((0,i.uX)(),(0,i.CE)("div",p,[b,(0,i.Lk)("div",w,(0,o.v_)(e.progress)+"%",1)])):(0,i.Q3)("",!0),"Stretch"===e.animation?((0,i.uX)(),(0,i.CE)("div",k,[y,(0,i.Lk)("div",L,(0,o.v_)(e.progress)+"%",1)])):(0,i.Q3)("",!0),"TextBlur"===e.animation?((0,i.uX)(),(0,i.CE)("div",x,T)):(0,i.Q3)("",!0)]))}});const A=(0,c.A)(D,[["__scopeId","data-v-9e9dfc54"]]);var S=A},24898:function(e,t,r){r.r(t),r.d(t,{default:function(){return b}});var i=r(58258),o=r(17562),a=r(69694),n=r(75030),s=r(64634),d=r(24953),l=r(57399),h=r(68309);class c{constructor(e){const{progress:t=s.lQ,complete:r=s.lQ,begin:i=s.lQ}=e;this.isAutoRotate=!1,this.scene=(0,a.H7)(),this.scene.background=new n.Q1f(65793),this.camera=(0,a.Gc)(new n.Pq0(0,50,100),55,1,2e4),this.renderer=(0,a.Ki)(),this.controls=(0,a.ZN)(this.camera,this.renderer,!1),this.controls.enableDamping=!0,this.controls.maxDistance=400,this.controls.minDistance=4,(0,a.AU)(this.scene,100),this.clock=(0,a.$i)();const o=new l.Z;o.setDecoderPath("/js/draco/");const h=new n.KPJ;this.loader=new d.B(h),this.loader.setDRACOLoader(o),this.textureLoader=new n.Tap(h),this.loadAssets(),this.initGui(),h.onProgress=(e,r,i)=>{t((0,s.tM)(r,i))},h.onLoad=()=>{setTimeout((()=>{r(),this.initMesh()}),1200)},this._resizeFn=this.resizeFn.bind(this),window.addEventListener("resize",this._resizeFn),this.render()}initLight(){const e=new n.$p8(16777215,2);this.scene.add(e)}loadAssets(){this.loader.load("/models/park/city.glb",(e=>{this.gltf=e})),this.textureLoader.load("/models/park/bakedDay.jpg",(e=>{this.bakedDayTexture=e,console.log(this.bakedDayTexture.encoding),this.bakedDayTexture.encoding=3001,this.bakedDayTexture.flipY=!1})),this.textureLoader.load("/models/park/bakedNight.jpg",(e=>{this.bakedNightTexture=e,this.bakedNightTexture.encoding=3001,this.bakedNightTexture.flipY=!1})),this.textureLoader.load("/models/park/lightMap.jpg",(e=>{this.lightMapTexture=e,this.lightMapTexture.encoding=3001,this.lightMapTexture.flipY=!1}))}initGui(){this.gui=(0,a._f)();const e={dayNight:!0,window:16777215,windowStrength:0,lamp:16777215,lampStrength:0,otherColor:16777215,otherStrength:0};this.gui.add(e,"dayNight").name("白天黑夜切换").onChange((e=>{e?new h.Ay.Tween({x:1}).to({x:0}).onUpdate((e=>{this.material.uniforms.uNightMix.value=e.x,this.material.needsUpdate=!0})).start():new h.Ay.Tween({x:0}).to({x:1}).onUpdate((e=>{this.material.uniforms.uNightMix.value=e.x,this.material.needsUpdate=!0})).start()}));const t=this.gui.addFolder("窗户");t.addColor(e,"window").name("颜色").onChange((e=>{this.material.uniforms.uLightWindowColor.value.set(e)})),t.add(e,"windowStrength",0,1).name("灯光强度").onChange((e=>{this.material.uniforms.uLightWindowStrength.value=e}));const r=this.gui.addFolder("路灯");r.addColor(e,"lamp").name("颜色").onChange((e=>{this.material.uniforms.uLightLamOtherolor.value.set(e)})),r.add(e,"lampStrength",0,1).name("灯光强度").onChange((e=>{this.material.uniforms.uLightLampStrength.value=e}));const i=this.gui.addFolder("其他");i.addColor(e,"otherColor").name("颜色").onChange((e=>{this.material.uniforms.uLightOtherColor.value.set(e)})),i.add(e,"otherStrength",0,1).name("灯光强度").onChange((e=>{this.material.uniforms.uLightOtherStrength.value=e}))}initMesh(){const e=this.gltf.scene.children[0],t=new n.BKk({uniforms:{uBakedDayTexture:{value:this.bakedDayTexture},uBakedNightTexture:{value:this.bakedNightTexture},uLightMapTexture:{value:this.lightMapTexture},uNightMix:{value:0},uNeutralMix:{value:0},uLightWindowColor:{value:new n.Q1f(16777215)},uLightWindowStrength:{value:0},uLightLamOtherolor:{value:new n.Q1f(16777215)},uLightLampStrength:{value:0},uLightOtherColor:{value:new n.Q1f(16777215)},uLightOtherStrength:{value:0}},vertexShader:"#define GLSLIFY 1\nvarying vec2 vUv;\n\nvoid main()\n{\n    vec4 modelPosition = modelMatrix * vec4(position, 1.0);\n    vec4 viewPosition = viewMatrix * modelPosition;\n    vec4 projectionPosition = projectionMatrix * viewPosition;\n    gl_Position = projectionPosition;\n\n    vUv = uv;\n}",fragmentShader:"#define GLSLIFY 1\nuniform sampler2D uBakedDayTexture;\nuniform sampler2D uBakedNightTexture;\nuniform sampler2D uLightMapTexture;\n\nuniform float uNightMix;\n\nuniform vec3 uLightWindowColor;\nuniform float uLightWindowStrength; \n\nuniform vec3 uLightLamOtherolor;\nuniform float uLightLampStrength; \n\nuniform vec3 uLightOtherColor;\nuniform float uLightOtherStrength; \n\nvarying vec2 vUv;\n\n// #pragma glslify: blend = require(glsl-blend/add)\n// #pragma glslify: blend = require(glsl-blend/lighten) // 混合\nvec3 blendNormal(vec3 base, vec3 blend) {\n\treturn blend;\n}\n\nvec3 blendNormal(vec3 base, vec3 blend, float opacity) {\n\treturn (blendNormal(base, blend) * opacity + base * (1.0 - opacity));\n}\n\n// #pragma glslify: blend = require(glsl-blend/screen)\n\nvoid main()\n{\n    vec3 bakedDayColor = texture2D(uBakedDayTexture, vUv).rgb;\n    vec3 bakedNightColor = texture2D(uBakedNightTexture, vUv).rgb;\n    vec3 bakedColor = mix(bakedDayColor, bakedNightColor, uNightMix);\n    vec3 lightMaOtherolor = texture2D(uLightMapTexture, vUv).rgb;\n\n    float lightLightStrength = lightMaOtherolor.b * uLightWindowStrength;\n    bakedColor = blendNormal(bakedColor, uLightWindowColor, lightLightStrength);\n\n    float lightOtherStrength = lightMaOtherolor.g * uLightOtherStrength;\n    bakedColor = blendNormal(bakedColor, uLightOtherColor, lightOtherStrength);\n\n    float lightLampStrength = lightMaOtherolor.r * uLightLampStrength;\n    bakedColor = blendNormal(bakedColor, uLightLamOtherolor, lightLampStrength);\n\n    gl_FragColor = vec4(bakedColor, 1.0);\n}"});this.material=t,e.traverse((e=>{e instanceof n.eaF&&(console.log(e,"el"),e.material=t)})),this.scene.add(e)}autoRotate(){this.isAutoRotate=!this.isAutoRotate,this.controls.autoRotate=this.isAutoRotate}resizeFn(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}render(){h.Ay.update(),this.renderer.render(this.scene,this.camera),this.controls.update(),this.timer=requestAnimationFrame(this.render.bind(this))}beforeDestroy(){this.timer&&cancelAnimationFrame(this.timer),window.addEventListener("resize",this._resizeFn),this.gui.destroy()}}var u=r(34056);const g={class:"relative"},f=(0,i.Lk)("div",{id:"webgl-output",class:"webgl-output"},null,-1),m={name:"SmartPark"};var v=Object.assign(m,{setup(e){let t=null;const r=(0,o.KR)(!0),a=(0,o.KR)(0);(0,i.sV)((()=>{t=new c({begin(){r.value=!0},progress(e){a.value=e},complete(){r.value=!1}})})),(0,i.xo)((()=>{t&&t.beforeDestroy&&t.beforeDestroy()}));return(e,t)=>((0,i.uX)(),(0,i.CE)("div",g,[f,r.value?((0,i.uX)(),(0,i.Wv)((0,o.R1)(u.X),{key:0,progress:a.value,animation:"TextBlur","background-color":"#000000"},null,8,["progress"])):(0,i.Q3)("",!0)]))}});const p=v;var b=p},57399:function(e,t,r){r.d(t,{Z:function(){return a}});r(53297),r(75898),r(66653),r(91242),r(26057),r(55624),r(39820),r(83202),r(77425),r(62228);var i=r(75030);const o=new WeakMap;class a extends i.aHM{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,o){const a=new i.Y9S(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(e=>{this.decodeDracoFile(e,t).catch(o)}),r,o)}decodeDracoFile(e,t,r,i){const o={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};return this.decodeGeometry(e,o).then(t)}decodeGeometry(e,t){const r=JSON.stringify(t);if(o.has(e)){const t=o.get(e);if(t.key===r)return t.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const a=this.workerNextTaskID++,n=e.byteLength,s=this._getWorker(a,n).then((r=>(i=r,new Promise(((r,o)=>{i._callbacks[a]={resolve:r,reject:o},i.postMessage({type:"decode",id:a,taskConfig:t,buffer:e},[e])}))))).then((e=>this._createGeometry(e.geometry)));return s.catch((()=>!0)).then((()=>{i&&a&&this._releaseTask(i,a)})),o.set(e,{key:r,promise:s}),s}_createGeometry(e){const t=new i.LoY;e.index&&t.setIndex(new i.THS(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const o=e.attributes[r],a=o.name,n=o.array,s=o.itemSize;t.setAttribute(a,new i.THS(n,s))}return t}_loadLibrary(e,t){const r=new i.Y9S(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise(((t,i)=>{r.load(e,t,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e="object"!==typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then((t=>{const r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);const i=n.toString(),o=["/* draco decoder */",r,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([o]))})),this.decoderPending}_getWorker(e,t){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){const r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r}))}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map((e=>e._taskLoad)))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function n(){let e,t;function r(e,t,r,a){const n=a.attributeIDs,s=a.attributeTypes;let d,l;const h=t.GetEncodedGeometryType(r);if(h===e.TRIANGULAR_MESH)d=new e.Mesh,l=t.DecodeBufferToMesh(r,d);else{if(h!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");d=new e.PointCloud,l=t.DecodeBufferToPointCloud(r,d)}if(!l.ok()||0===d.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const c={index:null,attributes:[]};for(const i in n){const r=self[s[i]];let l,h;if(a.useUniqueIDs)h=n[i],l=t.GetAttributeByUniqueId(d,h);else{if(h=t.GetAttributeId(d,e[n[i]]),-1===h)continue;l=t.GetAttribute(d,h)}c.attributes.push(o(e,t,d,i,r,l))}return h===e.TRIANGULAR_MESH&&(c.index=i(e,t,d)),e.destroy(d),c}function i(e,t,r){const i=r.num_faces(),o=3*i,a=4*o,n=e._malloc(a);t.GetTrianglesUInt32Array(r,a,n);const s=new Uint32Array(e.HEAPF32.buffer,n,o).slice();return e._free(n),{array:s,itemSize:1}}function o(e,t,r,i,o,n){const s=n.num_components(),d=r.num_points(),l=d*s,h=l*o.BYTES_PER_ELEMENT,c=a(e,o),u=e._malloc(h);t.GetAttributeDataArrayForAllPoints(r,n,c,h,u);const g=new o(e.HEAPF32.buffer,u,l).slice();return e._free(u),{name:i,array:g,itemSize:s}}function a(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}onmessage=function(i){const o=i.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":const i=o.buffer,a=o.taskConfig;t.then((e=>{const t=e.draco,n=new t.Decoder,s=new t.DecoderBuffer;s.Init(new Int8Array(i),i.byteLength);try{const e=r(t,n,s,a),i=e.attributes.map((e=>e.array.buffer));e.index&&i.push(e.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:e},i)}catch(d){console.error(d),self.postMessage({type:"error",id:o.id,error:d.message})}finally{t.destroy(s),t.destroy(n)}}));break}}}}}]);